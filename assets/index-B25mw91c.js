import{d as X,r as u,p as V,q as O,v as ee,x as te,c as y,o as p,y as Z,n as se,j as $,a as t,z as le,t as x,F as ae,g as oe,_ as Y,A as ne,u as ie,h as re,b as g,f as r,w as C,T as ue,e as J,B as ce,C as ve,D as de,G as me,H as fe,I as ge}from"./index-DJW2Dy9J.js";import{G as U}from"./GameButton-BuOxEFVG.js";import{H as G,s as b}from"./touch-handler-DtA4rPka.js";import{S as pe}from"./ParticleEffect.vue_vue_type_style_index_0_scoped_db33c9d5_lang-BnvsFOqQ.js";import{P as ye}from"./ParticleEffect-BB1JUNo_.js";const he={key:0,class:"active-indicator"},be={class:"plane-body"},we={class:"plane-cockpit"},_e={class:"answer-text"},xe={key:1,class:"explosion"},ke={key:2,class:"wrong-indicator"},Se=X({__name:"EnemyPlane",props:{id:{},value:{},isCorrect:{type:Boolean,default:!1},position:{default:()=>({x:0,y:0})},color:{default:"blue"},isHit:{type:Boolean,default:!1},isDestroyed:{type:Boolean,default:!1},isActive:{type:Boolean,default:!1},movePattern:{default:"horizontal"},moveSpeed:{default:2},moveRange:{default:150},isMoving:{type:Boolean,default:!0},isClickDisabled:{type:Boolean,default:!1}},emits:["click"],setup(d,{emit:B}){const e=d,P=B,o=u(0),l=u(0),c=u(0),n=u(0),f=u(1),D=u(0),k=u(null),M=u(!1),S=u({}),R=u(null),E=u(null),N=V(()=>[`plane-${e.color}`,{"plane-hit":e.isHit},{"plane-destroyed":e.isDestroyed},{"plane-active":e.isActive}]),z=V(()=>{const v=e.isActive?1.15:1,s=R.value!==null?R.value:o.value,w=E.value!==null?E.value:l.value,I={left:`calc(50% + ${s}px)`,top:`calc(50% + ${w}px)`,transform:`translate(-50%, -50%) scale(${v})`,transition:e.isHit||e.isDestroyed?"none":"all 0.05s linear"};return e.color&&e.color.startsWith("#")&&(I["--plane-color"]=e.color),I}),Q=()=>{e.isDestroyed||e.isHit||e.isClickDisabled||(G.light(),P("click",e.id))},W=v=>{if(e.isDestroyed||e.isHit||e.isClickDisabled)return;const s=v.touches[0],w=v.currentTarget.getBoundingClientRect(),I=s.clientX-w.left,m=s.clientY-w.top;S.value={left:`${I}px`,top:`${m}px`},M.value=!0,setTimeout(()=>{M.value=!1},600)},F=()=>{switch(T(),c.value=o.value,n.value=l.value,e.movePattern){case"horizontal":o.value=c.value,l.value=n.value,f.value=1;break;case"vertical":o.value=c.value,l.value=n.value,f.value=1;break;case"circular":D.value=0,o.value=c.value+e.moveRange*.6,l.value=n.value;break;case"zigzag":o.value=c.value,l.value=n.value,f.value=1;break;default:o.value=c.value,l.value=n.value}k.value=window.setInterval(()=>{if(!e.isDestroyed&&!e.isHit)switch(e.movePattern){case"horizontal":A();break;case"vertical":H();break;case"circular":j();break;case"zigzag":q();break;default:A()}},33)},A=()=>{o.value+=e.moveSpeed*f.value;const v=c.value-e.moveRange,s=c.value+e.moveRange;o.value<=v?(o.value=v,f.value=1):o.value>=s&&(o.value=s,f.value=-1);const w=Math.sin(Date.now()/800)*2;l.value=n.value+w},H=()=>{l.value+=e.moveSpeed*f.value;const v=n.value-e.moveRange,s=n.value+e.moveRange;l.value<=v?(l.value=v,f.value=1):l.value>=s&&(l.value=s,f.value=-1);const w=Math.sin(Date.now()/800)*2;o.value=c.value+w},j=()=>{D.value+=.02*e.moveSpeed;const v=e.moveRange*.5,s=e.moveRange*.3;o.value=c.value+Math.cos(D.value)*v,l.value=n.value+Math.sin(D.value)*s},q=()=>{o.value+=e.moveSpeed*f.value,o.value<=c.value-e.moveRange?(o.value=c.value-e.moveRange,f.value=1,l.value=l.value>n.value?n.value-e.moveRange*.2:n.value+e.moveRange*.2):o.value>=c.value+e.moveRange&&(o.value=c.value+e.moveRange,f.value=-1,l.value=l.value>n.value?n.value-e.moveRange*.3:n.value+e.moveRange*.3)},T=()=>{k.value&&(clearInterval(k.value),k.value=null)};return O(()=>e.isMoving,v=>{v?F():T()}),O(()=>e.isHit,v=>{v&&(T(),R.value=o.value,E.value=l.value)}),O(()=>e.isDestroyed,v=>{v&&T()}),ee(()=>{o.value=e.position.x||0,l.value=e.position.y||0,R.value=null,E.value=null,e.isMoving&&!e.isDestroyed&&F()}),te(()=>{T()}),(v,s)=>(p(),y("div",{class:se(["enemy-plane",N.value]),style:Z(z.value),onClick:Q,onTouchstart:W},[d.isActive?(p(),y("div",he,[...s[0]||(s[0]=[le('<div class="active-ring active-ring-outer" data-v-233996bd></div><div class="active-ring active-ring-inner" data-v-233996bd></div><div class="active-crosshair" data-v-233996bd><div class="crosshair-line crosshair-h" data-v-233996bd></div><div class="crosshair-line crosshair-v" data-v-233996bd></div></div><div class="target-corners" data-v-233996bd><div class="corner corner-tl" data-v-233996bd></div><div class="corner corner-tr" data-v-233996bd></div><div class="corner corner-bl" data-v-233996bd></div><div class="corner corner-br" data-v-233996bd></div></div>',4)])])):$("",!0),s[10]||(s[10]=t("div",{class:"engine-flame"},[t("div",{class:"flame flame-1"}),t("div",{class:"flame flame-2"}),t("div",{class:"flame flame-3"})],-1)),t("div",be,[s[3]||(s[3]=t("div",{class:"plane-wing plane-wing-top"},null,-1)),s[4]||(s[4]=t("div",{class:"plane-wing plane-wing-bottom"},null,-1)),t("div",we,[s[1]||(s[1]=t("div",{class:"cockpit-glass"},null,-1)),t("span",_e,x(d.value),1),s[2]||(s[2]=t("div",{class:"cockpit-detail"},null,-1))]),s[5]||(s[5]=t("div",{class:"plane-tail"},[t("div",{class:"tail-fin"})],-1))]),d.isDestroyed?(p(),y("div",xe,[s[6]||(s[6]=t("div",{class:"explosion-core"},null,-1)),(p(),y(ae,null,oe(12,w=>t("div",{key:w,class:"explosion-particle"})),64)),s[7]||(s[7]=t("div",{class:"explosion-ring"},null,-1)),s[8]||(s[8]=t("div",{class:"explosion-flash"},null,-1))])):$("",!0),d.isHit&&!d.isCorrect?(p(),y("div",ke,[...s[9]||(s[9]=[t("div",{class:"wrong-icon"},[t("span",{class:"wrong-text"},"‚úó")],-1),t("div",{class:"wrong-wave"},null,-1)])])):$("",!0),M.value?(p(),y("div",{key:3,class:"touch-ripple",style:Z(S.value)},null,4)):$("",!0)],38))}}),Ce=Y(Se,[["__scopeId","data-v-233996bd"]]),$e={class:"question-display"},Be={class:"question-container"},De={class:"question-text"},Re={class:"progress-info"},Ee={class:"progress-text"},Te=X({__name:"QuestionDisplay",props:{questionText:{default:""},currentIndex:{default:0},totalQuestions:{default:10}},setup(d){return(B,e)=>(p(),y("div",$e,[t("div",Be,[t("span",De,x(d.questionText),1)]),t("div",Re,[t("span",Ee,"Á¨¨ "+x(d.currentIndex+1)+" / "+x(d.totalQuestions)+" È¢ò",1)])]))}}),Ge=Y(Te,[["__scopeId","data-v-76168665"]]),Me={class:"game-stats"},ze={class:"stats-row"},Ae={class:"stat-item stat-score"},He={class:"stat-value"},Ie={key:0,class:"stat-item stat-combo"},qe={class:"stat-value combo-value"},Le={class:"stat-item stat-correct"},Pe={class:"stat-value"},Qe={class:"stat-item stat-wrong"},Fe={class:"stat-value"},Oe={key:1,class:"stat-item stat-timer"},Ve=X({__name:"GameStats",props:{score:{default:0},combo:{default:0},correctCount:{default:0},wrongCount:{default:0},timeLeft:{default:0},showTimer:{type:Boolean,default:!1}},setup(d){return(B,e)=>(p(),y("div",Me,[t("div",ze,[t("div",Ae,[e[0]||(e[0]=t("span",{class:"stat-icon"},"‚≠ê",-1)),t("span",He,x(d.score),1)]),d.combo>1?(p(),y("div",Ie,[e[1]||(e[1]=t("span",{class:"stat-label"},"ËøûÂáª",-1)),t("span",qe,x(d.combo)+"x",1)])):$("",!0),t("div",Le,[e[2]||(e[2]=t("span",{class:"stat-icon"},"‚úì",-1)),t("span",Pe,x(d.correctCount),1)]),t("div",Qe,[e[3]||(e[3]=t("span",{class:"stat-icon"},"‚úó",-1)),t("span",Fe,x(d.wrongCount),1)]),d.showTimer?(p(),y("div",Oe,[e[4]||(e[4]=t("span",{class:"stat-icon"},"‚è±",-1)),t("span",{class:se(["stat-value",{"timer-warning":d.timeLeft<=3}])},x(d.timeLeft)+"s",3)])):$("",!0)])]))}}),Xe=Y(Ve,[["__scopeId","data-v-95531e82"]]),K="/x-game/assets/bgm_battle-DrTQayCI.mp3",Ye={class:"number-battle-container"},Ne={key:0,class:"game-screen"},We={class:"game-area"},je={key:0,class:"error-message"},Ue={class:"game-controls"},Ze={key:1,class:"pause-screen"},Je={class:"pause-content"},Ke={class:"pause-buttons"},et=X({__name:"index",setup(d){const B=re(),e=ne(),P=ie(),o=u([]),l=u(""),c=u(10),n=u(null),f=u("explosion"),D=u(12),k=u(0),M=u({x:50,y:50}),S=u(!1),R=u(!1),E=u(""),N=V(()=>e.gameState.currentQuestion),z=V(()=>e.currentBattleQuestion),Q=()=>{if(!z.value)return;const m=[z.value.correctAnswer,...z.value.wrongAnswers],a=W(m);o.value=ce.createEnemies(a,z.value.correctAnswer)},W=m=>{const a=[...m];for(let i=a.length-1;i>0;i--){const _=Math.floor(Math.random()*(i+1));[a[i],a[_]]=[a[_],a[i]]}return a},F=m=>{if(S.value)return;const a=o.value.find(i=>i.id===m);!a||a.isHit||a.isDestroyed||(l.value=m,a.isHit=!0,o.value.forEach(i=>{i.isHit=!0}),a.isCorrect?(S.value=!0,b.play("correct"),G.success(),f.value="success",D.value=16,k.value++,setTimeout(()=>{a.isDestroyed=!0,b.play("explosion"),o.value.forEach(i=>{i.id!==a.id&&!i.isDestroyed&&(i.isDestroyed=!0)}),e.handleCorrectAnswer(),e.gameState.progress.combo>1&&(b.play("combo"),f.value="combo",k.value++),setTimeout(()=>{S.value=!1,A()},800)},300)):(S.value=!0,b.play("wrong"),G.error(),f.value="error",D.value=1,k.value++,M.value={x:a.position.x,y:a.position.y},E.value="‚ùå Á≠îÈîô‰∫ÜÔºÅüò¢",R.value=!0,e.handleWrongAnswer(a.value),setTimeout(()=>{R.value=!1,S.value=!1,a.isHit=!1,l.value="",A()},2e3)))},A=()=>{e.gameState.progress.currentIndex>=e.gameState.config.totalQuestions-1?I():(e.updateCurrentQuestion(),Q(),l.value="",e.gameState.config.difficulty==="hard"&&j())},H=()=>{e.gameState.config.difficulty==="hard"&&(c.value=10,n.value=window.setInterval(()=>{c.value--,c.value<=3&&c.value>0&&b.play("countdown"),c.value<=0&&(e.handleWrongAnswer(0),A())},1e3))},j=()=>{n.value&&clearInterval(n.value),H()},q=()=>{n.value&&(clearInterval(n.value),n.value=null)},T=()=>{b.play("select"),G.light(),e.pauseGame(),q()},v=()=>{b.play("select"),G.light(),e.resumeGame(),e.gameState.config.difficulty==="hard"&&H()},s=()=>{b.play("select"),G.light(),e.resetGame(),B.push("/number-battle/settings")},w=()=>{b.play("select"),G.light(),e.endGame(),B.push("/")},I=()=>{q(),b.play("gameOver");const m=e.endGame();P.updateLearningProgress({totalGames:1,totalCorrect:m.correctCount,totalWrong:m.wrongCount,totalTime:m.totalTime,bestScore:m.score}),P.checkAchievements(),B.push("/result")};return O(()=>e.gameState.status,m=>{m==="playing"&&e.gameState.config.difficulty==="hard"&&H()}),ee(()=>{if(e.gameState.status!=="playing"){B.push("/number-battle/settings");return}const m=()=>{const _=document.documentElement,L=_.requestFullscreen||_.webkitRequestFullscreen||_.mozRequestFullScreen||_.msRequestFullscreen;L&&L.call(_).catch(h=>{console.warn("ÂÖ®Â±èËØ∑Ê±ÇÂ§±Ë¥•:",h)})},a=()=>{m(),document.removeEventListener("click",a),document.removeEventListener("touchstart",a)};document.addEventListener("click",a,{once:!0}),document.addEventListener("touchstart",a,{once:!0}),m(),Q(),e.gameState.config.difficulty==="hard"&&H();const i=()=>{b.playBGM(K),document.removeEventListener("click",i),document.removeEventListener("touchstart",i)};document.addEventListener("click",i,{once:!0}),document.addEventListener("touchstart",i,{once:!0}),b.playBGM(K)}),te(()=>{q(),b.stopBGM()}),(m,a)=>{var L;const i=J("el-icon"),_=J("el-button");return p(),y("div",Ye,[g(r(pe)),r(e).gameState.status==="playing"?(p(),y("div",Ne,[g(r(Xe),{score:r(e).gameState.progress.score,combo:r(e).gameState.progress.combo,"correct-count":r(e).gameState.progress.correctCount,"wrong-count":r(e).gameState.progress.wrongCount,"time-left":c.value,"show-timer":r(e).gameState.config.difficulty==="hard"},null,8,["score","combo","correct-count","wrong-count","time-left","show-timer"]),g(r(Ge),{"question-text":((L=N.value)==null?void 0:L.text)||"","current-index":r(e).gameState.progress.currentIndex,"total-questions":r(e).gameState.config.totalQuestions},null,8,["question-text","current-index","total-questions"]),t("div",We,[(p(!0),y(ae,null,oe(o.value,h=>(p(),ve(r(Ce),{key:h.id,id:h.id,value:h.value,"is-correct":h.isCorrect,position:h.position,color:h.color,"is-hit":h.isHit,"is-destroyed":h.isDestroyed,"is-active":l.value===h.id,"move-pattern":h.movePattern,"move-speed":h.moveSpeed,"move-range":h.moveRange,"is-moving":r(e).gameState.config.enemyMoving,"is-click-disabled":S.value,onClick:F},null,8,["id","value","is-correct","position","color","is-hit","is-destroyed","is-active","move-pattern","move-speed","move-range","is-moving","is-click-disabled"]))),128)),g(ue,{name:"error-message"},{default:C(()=>[R.value?(p(),y("div",je,x(E.value),1)):$("",!0)]),_:1})]),t("div",Ue,[g(_,{circle:"",size:"large",onClick:T},{default:C(()=>[g(i,null,{default:C(()=>[g(r(de))]),_:1})]),_:1})])])):$("",!0),r(e).gameState.status==="paused"?(p(),y("div",Ze,[t("div",Je,[a[3]||(a[3]=t("h2",{class:"pause-title"},"Ê∏∏ÊàèÊöÇÂÅú",-1)),t("div",Ke,[g(r(U),{type:"success",size:"large",onClick:v},{default:C(()=>[g(i,null,{default:C(()=>[g(r(me))]),_:1}),a[0]||(a[0]=t("span",null,"ÁªßÁª≠Ê∏∏Êàè",-1))]),_:1}),g(r(U),{type:"warning",size:"large",onClick:s},{default:C(()=>[g(i,null,{default:C(()=>[g(r(fe))]),_:1}),a[1]||(a[1]=t("span",null,"ÈáçÊñ∞ÂºÄÂßã",-1))]),_:1}),g(r(U),{type:"danger",size:"large",onClick:w},{default:C(()=>[g(i,null,{default:C(()=>[g(r(ge))]),_:1}),a[2]||(a[2]=t("span",null,"ÈÄÄÂá∫Ê∏∏Êàè",-1))]),_:1})])])])):$("",!0),g(r(ye),{type:f.value,count:D.value,trigger:k.value,position:M.value},null,8,["type","count","trigger","position"])])}}}),nt=Y(et,[["__scopeId","data-v-3b4d1448"]]);export{nt as default};
