import{d as Q,r as d,p as P,q as X,v as Z,x as J,c as g,o as f,y as Y,n as K,j as S,a as t,z as ne,t as b,F as ee,g as te,_ as F,A as le,u as ie,h as re,b as m,f as i,w as x,T as ce,e as j,B as ue,C as de,D as ve,G as me,H as fe,I as ge}from"./index-J8i9tB8A.js";import{G as W}from"./GameButton-BwWB8KzV.js";import{H as G,s as h}from"./touch-handler-DtA4rPka.js";import{S as pe}from"./ParticleEffect.vue_vue_type_style_index_0_scoped_0f834ed3_lang-C1xJ9BwO.js";import{P as ye}from"./ParticleEffect-xsao217C.js";const he={key:0,class:"active-indicator"},we={class:"plane-body"},_e={class:"plane-cockpit"},be={class:"answer-text"},ke={key:1,class:"explosion"},xe={key:2,class:"wrong-indicator"},Se=Q({__name:"EnemyPlane",props:{id:{},value:{},isCorrect:{type:Boolean,default:!1},position:{default:()=>({x:0,y:0})},color:{default:"blue"},isHit:{type:Boolean,default:!1},isDestroyed:{type:Boolean,default:!1},isActive:{type:Boolean,default:!1},movePattern:{default:"horizontal"},moveSpeed:{default:2},moveRange:{default:150},isMoving:{type:Boolean,default:!0},isClickDisabled:{type:Boolean,default:!1}},emits:["click"],setup(c,{emit:C}){const e=c,A=C,o=d(0),n=d(0),u=d(1),w=d(0),k=d(null),B=d(!1),D=d({}),I=P(()=>[`plane-${e.color}`,{"plane-hit":e.isHit},{"plane-destroyed":e.isDestroyed},{"plane-active":e.isActive}]),$=P(()=>{const l=e.isActive?1.15:1,s=o.value,p=n.value,M={left:`calc(50% + ${s}px)`,top:`calc(50% + ${p}px)`,transform:`translate(-50%, -50%) scale(${l})`,transition:e.isDestroyed?"none":"all 0.05s linear"};return e.color&&e.color.startsWith("#")&&(M["--plane-color"]=e.color),M}),z=()=>{e.isDestroyed||e.isHit||e.isClickDisabled||(G.light(),A("click",e.id))},q=l=>{if(e.isDestroyed||e.isHit||e.isClickDisabled)return;const s=l.touches[0];if(!s)return;const p=l.currentTarget.getBoundingClientRect(),M=s.clientX-p.left,N=s.clientY-p.top;D.value={left:`${M}px`,top:`${N}px`},B.value=!0,setTimeout(()=>{B.value=!1},600)},H=()=>{switch(R(),e.movePattern){case"horizontal":o.value=-e.moveRange,n.value=0,u.value=1;break;case"vertical":o.value=0,n.value=-e.moveRange,u.value=1;break;case"circular":w.value=0,o.value=e.moveRange*.6,n.value=0;break;case"zigzag":o.value=-e.moveRange,n.value=-e.moveRange*.5,u.value=1;break;default:o.value=0,n.value=0}k.value=window.setInterval(()=>{if(!e.isDestroyed&&!e.isHit)switch(e.movePattern){case"horizontal":T();break;case"vertical":L();break;case"circular":O();break;case"zigzag":V();break;default:T()}},33)},T=()=>{o.value+=e.moveSpeed*u.value;const l=-e.moveRange,s=e.moveRange;o.value<=l?(o.value=l,u.value=1):o.value>=s&&(o.value=s,u.value=-1);const p=Math.sin(Date.now()/800)*2;n.value=p},L=()=>{n.value+=e.moveSpeed*u.value;const l=-e.moveRange,s=e.moveRange;n.value<=l?(n.value=l,u.value=1):n.value>=s&&(n.value=s,u.value=-1);const p=Math.sin(Date.now()/800)*2;o.value=p},O=()=>{w.value+=.02*e.moveSpeed;const l=e.moveRange*.5,s=e.moveRange*.3;o.value=Math.cos(w.value)*l,n.value=Math.sin(w.value)*s},V=()=>{o.value+=e.moveSpeed*u.value,o.value<=-e.moveRange?(o.value=-e.moveRange,u.value=1,n.value=n.value>0?-e.moveRange*.2:e.moveRange*.2):o.value>=e.moveRange&&(o.value=e.moveRange,u.value=-1,n.value=n.value>0?-e.moveRange*.3:e.moveRange*.3)},R=()=>{k.value&&(clearInterval(k.value),k.value=null)};return X(()=>e.isMoving,l=>{l?H():R()}),X(()=>e.isDestroyed,l=>{l&&R()}),Z(()=>{o.value=e.position.x||0,n.value=e.position.y||0,e.isMoving&&!e.isDestroyed&&H()}),J(()=>{R()}),(l,s)=>(f(),g("div",{class:K(["enemy-plane",I.value]),style:Y($.value),onClick:z,onTouchstart:q},[c.isActive?(f(),g("div",he,[...s[0]||(s[0]=[ne('<div class="active-ring active-ring-outer" data-v-044662ad></div><div class="active-ring active-ring-inner" data-v-044662ad></div><div class="active-crosshair" data-v-044662ad><div class="crosshair-line crosshair-h" data-v-044662ad></div><div class="crosshair-line crosshair-v" data-v-044662ad></div></div><div class="target-corners" data-v-044662ad><div class="corner corner-tl" data-v-044662ad></div><div class="corner corner-tr" data-v-044662ad></div><div class="corner corner-bl" data-v-044662ad></div><div class="corner corner-br" data-v-044662ad></div></div>',4)])])):S("",!0),s[10]||(s[10]=t("div",{class:"engine-flame"},[t("div",{class:"flame flame-1"}),t("div",{class:"flame flame-2"}),t("div",{class:"flame flame-3"})],-1)),t("div",we,[s[3]||(s[3]=t("div",{class:"plane-wing plane-wing-top"},null,-1)),s[4]||(s[4]=t("div",{class:"plane-wing plane-wing-bottom"},null,-1)),t("div",_e,[s[1]||(s[1]=t("div",{class:"cockpit-glass"},null,-1)),t("span",be,b(c.value),1),s[2]||(s[2]=t("div",{class:"cockpit-detail"},null,-1))]),s[5]||(s[5]=t("div",{class:"plane-tail"},[t("div",{class:"tail-fin"})],-1))]),c.isDestroyed?(f(),g("div",ke,[s[6]||(s[6]=t("div",{class:"explosion-core"},null,-1)),(f(),g(ee,null,te(12,p=>t("div",{key:p,class:"explosion-particle"})),64)),s[7]||(s[7]=t("div",{class:"explosion-ring"},null,-1)),s[8]||(s[8]=t("div",{class:"explosion-flash"},null,-1))])):S("",!0),c.isHit&&!c.isCorrect?(f(),g("div",xe,[...s[9]||(s[9]=[t("div",{class:"wrong-icon"},[t("span",{class:"wrong-text"},"‚úó")],-1),t("div",{class:"wrong-wave"},null,-1)])])):S("",!0),B.value?(f(),g("div",{key:3,class:"touch-ripple",style:Y(D.value)},null,4)):S("",!0)],38))}}),Ce=F(Se,[["__scopeId","data-v-044662ad"]]),$e={class:"question-display"},Re={class:"question-container"},Be={class:"question-text"},De={class:"progress-info"},Te={class:"progress-text"},Ee=Q({__name:"QuestionDisplay",props:{questionText:{default:""},currentIndex:{default:0},totalQuestions:{default:10}},setup(c){return(C,e)=>(f(),g("div",$e,[t("div",Re,[t("span",Be,b(c.questionText),1)]),t("div",De,[t("span",Te,"Á¨¨ "+b(c.currentIndex+1)+" / "+b(c.totalQuestions)+" È¢ò",1)])]))}}),Ge=F(Ee,[["__scopeId","data-v-b0412fc0"]]),Me={class:"game-stats"},ze={class:"stats-row"},Ae={class:"stat-item stat-score"},Ie={class:"stat-value"},qe={key:0,class:"stat-item stat-combo"},He={class:"stat-value combo-value"},Le={class:"stat-item stat-correct"},Pe={class:"stat-value"},Qe={class:"stat-item stat-wrong"},Fe={class:"stat-value"},Oe={key:1,class:"stat-item stat-timer"},Ve=Q({__name:"GameStats",props:{score:{default:0},combo:{default:0},correctCount:{default:0},wrongCount:{default:0},timeLeft:{default:0},showTimer:{type:Boolean,default:!1}},setup(c){return(C,e)=>(f(),g("div",Me,[t("div",ze,[t("div",Ae,[e[0]||(e[0]=t("span",{class:"stat-icon"},"‚≠ê",-1)),t("span",Ie,b(c.score),1)]),c.combo>1?(f(),g("div",qe,[e[1]||(e[1]=t("span",{class:"stat-label"},"ËøûÂáª",-1)),t("span",He,b(c.combo)+"x",1)])):S("",!0),t("div",Le,[e[2]||(e[2]=t("span",{class:"stat-icon"},"‚úì",-1)),t("span",Pe,b(c.correctCount),1)]),t("div",Qe,[e[3]||(e[3]=t("span",{class:"stat-icon"},"‚úó",-1)),t("span",Fe,b(c.wrongCount),1)]),c.showTimer?(f(),g("div",Oe,[e[4]||(e[4]=t("span",{class:"stat-icon"},"‚è±",-1)),t("span",{class:K(["stat-value",{"timer-warning":c.timeLeft<=3}])},b(c.timeLeft)+"s",3)])):S("",!0)])]))}}),Ne=F(Ve,[["__scopeId","data-v-20c47e84"]]),U="/assets/bgm_battle-DrTQayCI.mp3",We={class:"number-battle-container"},Xe={key:0,class:"game-screen"},Ye={class:"game-area"},je={key:0,class:"error-message"},Ue={class:"game-controls"},Ze={key:1,class:"pause-screen"},Je={class:"pause-content"},Ke={class:"pause-buttons"},et=Q({__name:"index",setup(c){const C=re(),e=le(),A=ie(),o=d([]),n=d(""),u=d(10),w=d(null),k=d("explosion"),B=d(12),D=d(0),I=d({x:50,y:50}),$=d(!1),z=d(!1),q=d(""),H=P(()=>e.gameState.currentQuestion),T=P(()=>e.currentBattleQuestion),L=()=>{if(!T.value)return;const v=[T.value.correctAnswer,...T.value.wrongAnswers],a=O(v);o.value=ue.createEnemies(a,T.value.correctAnswer)},O=v=>{const a=[...v];for(let r=a.length-1;r>0;r--){const _=Math.floor(Math.random()*(r+1)),E=a[r];a[r]=a[_],a[_]=E}return a},V=v=>{if($.value)return;const a=o.value.find(r=>r.id===v);!a||a.isHit||a.isDestroyed||(n.value=v,a.isHit=!0,a.isCorrect?($.value=!0,h.play("correct"),G.success(),k.value="success",B.value=16,D.value++,setTimeout(()=>{a.isDestroyed=!0,h.play("explosion"),o.value.forEach(r=>{r.id!==a.id&&!r.isDestroyed&&(r.isDestroyed=!0)}),e.handleCorrectAnswer(),e.gameState.progress.combo>1&&(h.play("combo"),k.value="combo",D.value++),setTimeout(()=>{$.value=!1,R()},800)},300)):($.value=!0,h.play("wrong"),G.error(),k.value="error",B.value=1,D.value++,I.value={x:a.position.x,y:a.position.y},q.value="‚ùå Á≠îÈîô‰∫ÜÔºÅüò¢",z.value=!0,e.handleWrongAnswer(a.value),setTimeout(()=>{z.value=!1,$.value=!1,a.isHit=!1,n.value="",R()},2e3)))},R=()=>{e.gameState.progress.currentIndex>=e.gameState.config.totalQuestions-1?oe():(e.updateCurrentQuestion(),L(),n.value="",e.gameState.config.difficulty==="hard"&&s())},l=()=>{e.gameState.config.difficulty==="hard"&&(u.value=10,w.value=window.setInterval(()=>{u.value--,u.value<=3&&u.value>0&&h.play("countdown"),u.value<=0&&(e.handleWrongAnswer(0),R())},1e3))},s=()=>{w.value&&clearInterval(w.value),l()},p=()=>{w.value&&(clearInterval(w.value),w.value=null)},M=()=>{h.play("select"),G.light(),e.pauseGame(),p()},N=()=>{h.play("select"),G.light(),e.resumeGame(),e.gameState.config.difficulty==="hard"&&l()},se=()=>{h.play("select"),G.light(),e.resetGame(),C.push("/number-battle/settings")},ae=()=>{h.play("select"),G.light(),e.endGame(),C.push("/")},oe=()=>{p(),h.play("gameOver");const v=e.endGame();A.updateLearningProgress({totalGames:1,totalCorrect:v.correctCount,totalWrong:v.wrongCount,totalTime:v.totalTime,bestScore:v.score}),A.checkAchievements(),C.push("/result")};return X(()=>e.gameState.status,v=>{v==="playing"&&e.gameState.config.difficulty==="hard"&&l()}),Z(()=>{if(e.gameState.status!=="playing"){C.push("/number-battle/settings");return}const v=()=>{const _=document.documentElement,E=_.requestFullscreen||_.webkitRequestFullscreen||_.mozRequestFullScreen||_.msRequestFullscreen;E&&E.call(_).catch(y=>{console.warn("ÂÖ®Â±èËØ∑Ê±ÇÂ§±Ë¥•:",y)})},a=()=>{v(),document.removeEventListener("click",a),document.removeEventListener("touchstart",a)};document.addEventListener("click",a,{once:!0}),document.addEventListener("touchstart",a,{once:!0}),v(),L(),e.gameState.config.difficulty==="hard"&&l();const r=()=>{h.playBGM(U),document.removeEventListener("click",r),document.removeEventListener("touchstart",r)};document.addEventListener("click",r,{once:!0}),document.addEventListener("touchstart",r,{once:!0}),h.playBGM(U)}),J(()=>{p(),h.stopBGM()}),(v,a)=>{var E;const r=j("el-icon"),_=j("el-button");return f(),g("div",We,[m(i(pe)),i(e).gameState.status==="playing"?(f(),g("div",Xe,[m(i(Ne),{score:i(e).gameState.progress.score,combo:i(e).gameState.progress.combo,"correct-count":i(e).gameState.progress.correctCount,"wrong-count":i(e).gameState.progress.wrongCount,"time-left":u.value,"show-timer":i(e).gameState.config.difficulty==="hard"},null,8,["score","combo","correct-count","wrong-count","time-left","show-timer"]),m(i(Ge),{"question-text":((E=H.value)==null?void 0:E.text)||"","current-index":i(e).gameState.progress.currentIndex,"total-questions":i(e).gameState.config.totalQuestions},null,8,["question-text","current-index","total-questions"]),t("div",Ye,[(f(!0),g(ee,null,te(o.value,y=>(f(),de(i(Ce),{key:y.id,id:y.id,value:y.value,"is-correct":y.isCorrect,position:y.position,color:y.color,"is-hit":y.isHit,"is-destroyed":y.isDestroyed,"is-active":n.value===y.id,"move-pattern":y.movePattern,"move-speed":y.moveSpeed,"move-range":y.moveRange,"is-moving":i(e).gameState.config.enemyMoving,"is-click-disabled":$.value,onClick:V},null,8,["id","value","is-correct","position","color","is-hit","is-destroyed","is-active","move-pattern","move-speed","move-range","is-moving","is-click-disabled"]))),128)),m(ce,{name:"error-message"},{default:x(()=>[z.value?(f(),g("div",je,b(q.value),1)):S("",!0)]),_:1})]),t("div",Ue,[m(_,{circle:"",size:"large",onClick:M},{default:x(()=>[m(r,null,{default:x(()=>[m(i(ve))]),_:1})]),_:1})])])):S("",!0),i(e).gameState.status==="paused"?(f(),g("div",Ze,[t("div",Je,[a[3]||(a[3]=t("h2",{class:"pause-title"},"Ê∏∏ÊàèÊöÇÂÅú",-1)),t("div",Ke,[m(i(W),{type:"success",size:"large",onClick:N},{default:x(()=>[m(r,null,{default:x(()=>[m(i(me))]),_:1}),a[0]||(a[0]=t("span",null,"ÁªßÁª≠Ê∏∏Êàè",-1))]),_:1}),m(i(W),{type:"warning",size:"large",onClick:se},{default:x(()=>[m(r,null,{default:x(()=>[m(i(fe))]),_:1}),a[1]||(a[1]=t("span",null,"ÈáçÊñ∞ÂºÄÂßã",-1))]),_:1}),m(i(W),{type:"danger",size:"large",onClick:ae},{default:x(()=>[m(r,null,{default:x(()=>[m(i(ge))]),_:1}),a[2]||(a[2]=t("span",null,"ÈÄÄÂá∫Ê∏∏Êàè",-1))]),_:1})])])])):S("",!0),m(i(ye),{type:k.value,count:B.value,trigger:D.value,position:I.value},null,8,["type","count","trigger","position"])])}}}),lt=F(et,[["__scopeId","data-v-a614a313"]]);export{lt as default};
