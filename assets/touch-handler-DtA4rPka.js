var m=Object.defineProperty;var d=(a,t,e)=>t in a?m(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var o=(a,t,e)=>d(a,typeof t!="symbol"?t+"":t,e);class p{constructor(){o(this,"enabled",!0);o(this,"volume",.5);o(this,"musicEnabled",!0);o(this,"musicVolume",.3);o(this,"audioContext",null);o(this,"bgmAudio",null);this.initAudioContext(),this.loadSettings()}initAudioContext(){try{typeof window<"u"&&(this.audioContext=new(window.AudioContext||window.webkitAudioContext))}catch(t){console.error("初始化 AudioContext 失败:",t)}}play(t){if(!(!this.enabled||!this.audioContext))try{switch(t){case"correct":this.playCorrect();break;case"wrong":this.playWrong();break;case"attack":this.playAttack();break;case"explosion":this.playExplosion();break;case"select":this.playSelect();break;case"combo":this.playCombo();break;case"countdown":this.playCountdown();break;case"appear":this.playAppear();break;case"gameStart":this.playGameStart();break;case"gameOver":this.playGameOver();break}}catch(e){console.error("播放音效失败:",e)}}playCorrect(){this.playTone([523.25,659.25,783.99],.1,"sine")}playWrong(){this.playTone([200,150],.2,"sawtooth")}playAttack(){this.playTone([800,400],.05,"square")}playExplosion(){if(!this.audioContext)return;const t=this.audioContext.currentTime,e=this.audioContext.createOscillator(),i=this.audioContext.createGain();e.connect(i),i.connect(this.audioContext.destination),e.type="sawtooth",e.frequency.setValueAtTime(200,t),e.frequency.exponentialRampToValueAtTime(50,t+.3),i.gain.setValueAtTime(this.volume,t),i.gain.exponentialRampToValueAtTime(.01,t+.3),e.start(t),e.stop(t+.3)}playSelect(){this.playTone([400],.05,"sine")}playCombo(){this.playTone([659.25,783.99,987.77],.08,"sine")}playCountdown(){this.playTone([440],.1,"sine")}playAppear(){this.playTone([300,400,500],.1,"triangle")}playGameStart(){this.playTone([523.25,659.25,783.99,1046.5],.15,"sine")}playGameOver(){this.playTone([783.99,659.25,523.25,392],.2,"sine")}playTone(t,e,i="sine"){if(!this.audioContext)return;const c=this.audioContext.currentTime;t.forEach((l,h)=>{const s=this.audioContext.createOscillator(),n=this.audioContext.createGain();s.connect(n),n.connect(this.audioContext.destination),s.type=i,s.frequency.value=l;const r=c+h*e,u=r+e;n.gain.setValueAtTime(this.volume,r),n.gain.exponentialRampToValueAtTime(.01,u),s.start(r),s.stop(u)})}playBGM(t){if(this.musicEnabled)try{this.bgmAudio||(this.bgmAudio=new Audio(t),this.bgmAudio.loop=!0,this.bgmAudio.volume=this.musicVolume,this.bgmAudio.setAttribute("playsinline","true"),this.bgmAudio.setAttribute("webkit-playsinline","true"),this.bgmAudio.crossOrigin="anonymous");const e=this.bgmAudio.play();e!==void 0&&e.catch(i=>{console.error("播放背景音乐失败:",i),this.setupAudioPlayOnUserInteraction()})}catch(e){console.error("创建背景音乐失败:",e)}}setupAudioPlayOnUserInteraction(){const t=()=>{this.bgmAudio&&this.bgmAudio.paused&&this.bgmAudio.play().catch(e=>{console.error("用户交互播放失败:",e)}),document.removeEventListener("click",t),document.removeEventListener("touchstart",t)};document.addEventListener("click",t,{once:!0}),document.addEventListener("touchstart",t,{once:!0})}stopBGM(){this.bgmAudio&&(this.bgmAudio.pause(),this.bgmAudio.currentTime=0)}setEnabled(t){this.enabled=t,this.saveSettings()}setVolume(t){this.volume=Math.max(0,Math.min(1,t)),this.saveSettings()}setMusicEnabled(t){this.musicEnabled=t,t||this.stopBGM(),this.saveSettings()}setMusicVolume(t){this.musicVolume=Math.max(0,Math.min(1,t)),this.bgmAudio&&(this.bgmAudio.volume=this.musicVolume),this.saveSettings()}getSettings(){return{enabled:this.enabled,volume:this.volume,musicEnabled:this.musicEnabled,musicVolume:this.musicVolume}}saveSettings(){const t=this.getSettings();localStorage.setItem("sound_settings",JSON.stringify(t))}loadSettings(){try{const t=localStorage.getItem("sound_settings");if(t){const e=JSON.parse(t);this.enabled=e.enabled,this.volume=e.volume,this.musicEnabled=e.musicEnabled,this.musicVolume=e.musicVolume}}catch(t){console.error("加载音效设置失败:",t)}}}const b=new p;class y{static light(){"vibrate"in navigator&&navigator.vibrate(10)}static medium(){"vibrate"in navigator&&navigator.vibrate(20)}static heavy(){"vibrate"in navigator&&navigator.vibrate(50)}static success(){"vibrate"in navigator&&navigator.vibrate([10,50,10])}static error(){"vibrate"in navigator&&navigator.vibrate([50,100,50])}static warning(){"vibrate"in navigator&&navigator.vibrate([30,50,30])}}export{y as H,b as s};
