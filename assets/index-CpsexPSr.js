import{d as O,r as d,p as F,q as j,v as K,x as ee,c as y,o as p,y as U,n as te,j as $,a as t,z as le,t as x,F as se,g as ae,_ as V,A as ne,u as ie,h as re,b as g,f as i,w as C,T as ue,e as Z,B as ce,C as ve,D as de,G as me,H as fe,I as ge}from"./index-CV7umQ8o.js";import{G as Y}from"./GameButton-DP0dM53k.js";import{H as R,s as b}from"./touch-handler-DtA4rPka.js";import{S as pe}from"./ParticleEffect.vue_vue_type_style_index_0_scoped_db33c9d5_lang-D38TuCCH.js";import{P as ye}from"./ParticleEffect-BGkooad0.js";const he={key:0,class:"active-indicator"},be={class:"plane-body"},we={class:"plane-cockpit"},_e={class:"answer-text"},xe={key:1,class:"explosion"},ke={key:2,class:"wrong-indicator"},Se=O({__name:"EnemyPlane",props:{id:{},value:{},isCorrect:{type:Boolean,default:!1},position:{default:()=>({x:0,y:0})},color:{default:"blue"},isHit:{type:Boolean,default:!1},isDestroyed:{type:Boolean,default:!1},isActive:{type:Boolean,default:!1},movePattern:{default:"horizontal"},moveSpeed:{default:2},moveRange:{default:150},isMoving:{type:Boolean,default:!0},isClickDisabled:{type:Boolean,default:!1}},emits:["click"],setup(v,{emit:B}){const e=v,L=B,o=d(0),l=d(0),r=d(0),n=d(0),m=d(1),D=d(0),k=d(null),T=d(!1),S=d({}),A=F(()=>[`plane-${e.color}`,{"plane-hit":e.isHit},{"plane-destroyed":e.isDestroyed},{"plane-active":e.isActive}]),P=F(()=>{const u=e.isActive?1.15:1,s=o.value,w=l.value,z={left:`calc(50% + ${s}px)`,top:`calc(50% + ${w}px)`,transform:`translate(-50%, -50%) scale(${u})`,transition:e.isDestroyed?"none":"all 0.05s linear"};return e.color&&e.color.startsWith("#")&&(z["--plane-color"]=e.color),z}),N=()=>{e.isDestroyed||e.isHit||e.isClickDisabled||(R.light(),L("click",e.id))},E=u=>{if(e.isDestroyed||e.isHit||e.isClickDisabled)return;const s=u.touches[0],w=u.currentTarget.getBoundingClientRect(),z=s.clientX-w.left,X=s.clientY-w.top;S.value={left:`${z}px`,top:`${X}px`},T.value=!0,setTimeout(()=>{T.value=!1},600)},I=()=>{switch(M(),r.value=o.value,n.value=l.value,e.movePattern){case"horizontal":o.value=r.value,l.value=n.value,m.value=1;break;case"vertical":o.value=r.value,l.value=n.value,m.value=1;break;case"circular":D.value=0,o.value=r.value+e.moveRange*.6,l.value=n.value;break;case"zigzag":o.value=r.value,l.value=n.value,m.value=1;break;default:o.value=r.value,l.value=n.value}k.value=window.setInterval(()=>{if(!e.isDestroyed&&!e.isHit)switch(e.movePattern){case"horizontal":Q();break;case"vertical":W();break;case"circular":q();break;case"zigzag":G();break;default:Q()}},33)},Q=()=>{o.value+=e.moveSpeed*m.value;const u=r.value-e.moveRange,s=r.value+e.moveRange;o.value<=u?(o.value=u,m.value=1):o.value>=s&&(o.value=s,m.value=-1);const w=Math.sin(Date.now()/800)*2;l.value=n.value+w},W=()=>{l.value+=e.moveSpeed*m.value;const u=n.value-e.moveRange,s=n.value+e.moveRange;l.value<=u?(l.value=u,m.value=1):l.value>=s&&(l.value=s,m.value=-1);const w=Math.sin(Date.now()/800)*2;o.value=r.value+w},q=()=>{D.value+=.02*e.moveSpeed;const u=e.moveRange*.5,s=e.moveRange*.3;o.value=r.value+Math.cos(D.value)*u,l.value=n.value+Math.sin(D.value)*s},G=()=>{o.value+=e.moveSpeed*m.value,o.value<=r.value-e.moveRange?(o.value=r.value-e.moveRange,m.value=1,l.value=l.value>n.value?n.value-e.moveRange*.2:n.value+e.moveRange*.2):o.value>=r.value+e.moveRange&&(o.value=r.value+e.moveRange,m.value=-1,l.value=l.value>n.value?n.value-e.moveRange*.3:n.value+e.moveRange*.3)},M=()=>{k.value&&(clearInterval(k.value),k.value=null)};return j(()=>e.isMoving,u=>{u?I():M()}),j(()=>e.isDestroyed,u=>{u&&M()}),K(()=>{o.value=e.position.x||0,l.value=e.position.y||0,e.isMoving&&!e.isDestroyed&&I()}),ee(()=>{M()}),(u,s)=>(p(),y("div",{class:te(["enemy-plane",A.value]),style:U(P.value),onClick:N,onTouchstart:E},[v.isActive?(p(),y("div",he,[...s[0]||(s[0]=[le('<div class="active-ring active-ring-outer" data-v-7db482ea></div><div class="active-ring active-ring-inner" data-v-7db482ea></div><div class="active-crosshair" data-v-7db482ea><div class="crosshair-line crosshair-h" data-v-7db482ea></div><div class="crosshair-line crosshair-v" data-v-7db482ea></div></div><div class="target-corners" data-v-7db482ea><div class="corner corner-tl" data-v-7db482ea></div><div class="corner corner-tr" data-v-7db482ea></div><div class="corner corner-bl" data-v-7db482ea></div><div class="corner corner-br" data-v-7db482ea></div></div>',4)])])):$("",!0),s[10]||(s[10]=t("div",{class:"engine-flame"},[t("div",{class:"flame flame-1"}),t("div",{class:"flame flame-2"}),t("div",{class:"flame flame-3"})],-1)),t("div",be,[s[3]||(s[3]=t("div",{class:"plane-wing plane-wing-top"},null,-1)),s[4]||(s[4]=t("div",{class:"plane-wing plane-wing-bottom"},null,-1)),t("div",we,[s[1]||(s[1]=t("div",{class:"cockpit-glass"},null,-1)),t("span",_e,x(v.value),1),s[2]||(s[2]=t("div",{class:"cockpit-detail"},null,-1))]),s[5]||(s[5]=t("div",{class:"plane-tail"},[t("div",{class:"tail-fin"})],-1))]),v.isDestroyed?(p(),y("div",xe,[s[6]||(s[6]=t("div",{class:"explosion-core"},null,-1)),(p(),y(se,null,ae(12,w=>t("div",{key:w,class:"explosion-particle"})),64)),s[7]||(s[7]=t("div",{class:"explosion-ring"},null,-1)),s[8]||(s[8]=t("div",{class:"explosion-flash"},null,-1))])):$("",!0),v.isHit&&!v.isCorrect?(p(),y("div",ke,[...s[9]||(s[9]=[t("div",{class:"wrong-icon"},[t("span",{class:"wrong-text"},"‚úó")],-1),t("div",{class:"wrong-wave"},null,-1)])])):$("",!0),T.value?(p(),y("div",{key:3,class:"touch-ripple",style:U(S.value)},null,4)):$("",!0)],38))}}),Ce=V(Se,[["__scopeId","data-v-7db482ea"]]),$e={class:"question-display"},Be={class:"question-container"},De={class:"question-text"},Re={class:"progress-info"},Te={class:"progress-text"},Ee=O({__name:"QuestionDisplay",props:{questionText:{default:""},currentIndex:{default:0},totalQuestions:{default:10}},setup(v){return(B,e)=>(p(),y("div",$e,[t("div",Be,[t("span",De,x(v.questionText),1)]),t("div",Re,[t("span",Te,"Á¨¨ "+x(v.currentIndex+1)+" / "+x(v.totalQuestions)+" È¢ò",1)])]))}}),Ge=V(Ee,[["__scopeId","data-v-76168665"]]),Me={class:"game-stats"},ze={class:"stats-row"},Ae={class:"stat-item stat-score"},Ie={class:"stat-value"},qe={key:0,class:"stat-item stat-combo"},He={class:"stat-value combo-value"},Le={class:"stat-item stat-correct"},Pe={class:"stat-value"},Qe={class:"stat-item stat-wrong"},Fe={class:"stat-value"},Oe={key:1,class:"stat-item stat-timer"},Ve=O({__name:"GameStats",props:{score:{default:0},combo:{default:0},correctCount:{default:0},wrongCount:{default:0},timeLeft:{default:0},showTimer:{type:Boolean,default:!1}},setup(v){return(B,e)=>(p(),y("div",Me,[t("div",ze,[t("div",Ae,[e[0]||(e[0]=t("span",{class:"stat-icon"},"‚≠ê",-1)),t("span",Ie,x(v.score),1)]),v.combo>1?(p(),y("div",qe,[e[1]||(e[1]=t("span",{class:"stat-label"},"ËøûÂáª",-1)),t("span",He,x(v.combo)+"x",1)])):$("",!0),t("div",Le,[e[2]||(e[2]=t("span",{class:"stat-icon"},"‚úì",-1)),t("span",Pe,x(v.correctCount),1)]),t("div",Qe,[e[3]||(e[3]=t("span",{class:"stat-icon"},"‚úó",-1)),t("span",Fe,x(v.wrongCount),1)]),v.showTimer?(p(),y("div",Oe,[e[4]||(e[4]=t("span",{class:"stat-icon"},"‚è±",-1)),t("span",{class:te(["stat-value",{"timer-warning":v.timeLeft<=3}])},x(v.timeLeft)+"s",3)])):$("",!0)])]))}}),Ne=V(Ve,[["__scopeId","data-v-95531e82"]]),J="/x-game/assets/bgm_battle-DrTQayCI.mp3",We={class:"number-battle-container"},Xe={key:0,class:"game-screen"},Ye={class:"game-area"},je={key:0,class:"error-message"},Ue={class:"game-controls"},Ze={key:1,class:"pause-screen"},Je={class:"pause-content"},Ke={class:"pause-buttons"},et=O({__name:"index",setup(v){const B=re(),e=ne(),L=ie(),o=d([]),l=d(""),r=d(10),n=d(null),m=d("explosion"),D=d(12),k=d(0),T=d({x:50,y:50}),S=d(!1),A=d(!1),P=d(""),N=F(()=>e.gameState.currentQuestion),E=F(()=>e.currentBattleQuestion),I=()=>{if(!E.value)return;const f=[E.value.correctAnswer,...E.value.wrongAnswers],a=Q(f);o.value=ce.createEnemies(a,E.value.correctAnswer)},Q=f=>{const a=[...f];for(let c=a.length-1;c>0;c--){const _=Math.floor(Math.random()*(c+1));[a[c],a[_]]=[a[_],a[c]]}return a},W=f=>{if(S.value)return;const a=o.value.find(c=>c.id===f);!a||a.isHit||a.isDestroyed||(l.value=f,a.isHit=!0,a.isCorrect?(S.value=!0,b.play("correct"),R.success(),m.value="success",D.value=16,k.value++,setTimeout(()=>{a.isDestroyed=!0,b.play("explosion"),o.value.forEach(c=>{c.id!==a.id&&!c.isDestroyed&&(c.isDestroyed=!0)}),e.handleCorrectAnswer(),e.gameState.progress.combo>1&&(b.play("combo"),m.value="combo",k.value++),setTimeout(()=>{S.value=!1,q()},800)},300)):(S.value=!0,b.play("wrong"),R.error(),m.value="error",D.value=1,k.value++,T.value={x:a.position.x,y:a.position.y},P.value="‚ùå Á≠îÈîô‰∫ÜÔºÅüò¢",A.value=!0,e.handleWrongAnswer(a.value),setTimeout(()=>{A.value=!1,S.value=!1,a.isHit=!1,l.value="",q()},2e3)))},q=()=>{e.gameState.progress.currentIndex>=e.gameState.config.totalQuestions-1?oe():(e.updateCurrentQuestion(),I(),l.value="",e.gameState.config.difficulty==="hard"&&M())},G=()=>{e.gameState.config.difficulty==="hard"&&(r.value=10,n.value=window.setInterval(()=>{r.value--,r.value<=3&&r.value>0&&b.play("countdown"),r.value<=0&&(e.handleWrongAnswer(0),q())},1e3))},M=()=>{n.value&&clearInterval(n.value),G()},u=()=>{n.value&&(clearInterval(n.value),n.value=null)},s=()=>{b.play("select"),R.light(),e.pauseGame(),u()},w=()=>{b.play("select"),R.light(),e.resumeGame(),e.gameState.config.difficulty==="hard"&&G()},z=()=>{b.play("select"),R.light(),e.resetGame(),B.push("/number-battle/settings")},X=()=>{b.play("select"),R.light(),e.endGame(),B.push("/")},oe=()=>{u(),b.play("gameOver");const f=e.endGame();L.updateLearningProgress({totalGames:1,totalCorrect:f.correctCount,totalWrong:f.wrongCount,totalTime:f.totalTime,bestScore:f.score}),L.checkAchievements(),B.push("/result")};return j(()=>e.gameState.status,f=>{f==="playing"&&e.gameState.config.difficulty==="hard"&&G()}),K(()=>{if(e.gameState.status!=="playing"){B.push("/number-battle/settings");return}const f=()=>{const _=document.documentElement,H=_.requestFullscreen||_.webkitRequestFullscreen||_.mozRequestFullScreen||_.msRequestFullscreen;H&&H.call(_).catch(h=>{console.warn("ÂÖ®Â±èËØ∑Ê±ÇÂ§±Ë¥•:",h)})},a=()=>{f(),document.removeEventListener("click",a),document.removeEventListener("touchstart",a)};document.addEventListener("click",a,{once:!0}),document.addEventListener("touchstart",a,{once:!0}),f(),I(),e.gameState.config.difficulty==="hard"&&G();const c=()=>{b.playBGM(J),document.removeEventListener("click",c),document.removeEventListener("touchstart",c)};document.addEventListener("click",c,{once:!0}),document.addEventListener("touchstart",c,{once:!0}),b.playBGM(J)}),ee(()=>{u(),b.stopBGM()}),(f,a)=>{var H;const c=Z("el-icon"),_=Z("el-button");return p(),y("div",We,[g(i(pe)),i(e).gameState.status==="playing"?(p(),y("div",Xe,[g(i(Ne),{score:i(e).gameState.progress.score,combo:i(e).gameState.progress.combo,"correct-count":i(e).gameState.progress.correctCount,"wrong-count":i(e).gameState.progress.wrongCount,"time-left":r.value,"show-timer":i(e).gameState.config.difficulty==="hard"},null,8,["score","combo","correct-count","wrong-count","time-left","show-timer"]),g(i(Ge),{"question-text":((H=N.value)==null?void 0:H.text)||"","current-index":i(e).gameState.progress.currentIndex,"total-questions":i(e).gameState.config.totalQuestions},null,8,["question-text","current-index","total-questions"]),t("div",Ye,[(p(!0),y(se,null,ae(o.value,h=>(p(),ve(i(Ce),{key:h.id,id:h.id,value:h.value,"is-correct":h.isCorrect,position:h.position,color:h.color,"is-hit":h.isHit,"is-destroyed":h.isDestroyed,"is-active":l.value===h.id,"move-pattern":h.movePattern,"move-speed":h.moveSpeed,"move-range":h.moveRange,"is-moving":i(e).gameState.config.enemyMoving,"is-click-disabled":S.value,onClick:W},null,8,["id","value","is-correct","position","color","is-hit","is-destroyed","is-active","move-pattern","move-speed","move-range","is-moving","is-click-disabled"]))),128)),g(ue,{name:"error-message"},{default:C(()=>[A.value?(p(),y("div",je,x(P.value),1)):$("",!0)]),_:1})]),t("div",Ue,[g(_,{circle:"",size:"large",onClick:s},{default:C(()=>[g(c,null,{default:C(()=>[g(i(de))]),_:1})]),_:1})])])):$("",!0),i(e).gameState.status==="paused"?(p(),y("div",Ze,[t("div",Je,[a[3]||(a[3]=t("h2",{class:"pause-title"},"Ê∏∏ÊàèÊöÇÂÅú",-1)),t("div",Ke,[g(i(Y),{type:"success",size:"large",onClick:w},{default:C(()=>[g(c,null,{default:C(()=>[g(i(me))]),_:1}),a[0]||(a[0]=t("span",null,"ÁªßÁª≠Ê∏∏Êàè",-1))]),_:1}),g(i(Y),{type:"warning",size:"large",onClick:z},{default:C(()=>[g(c,null,{default:C(()=>[g(i(fe))]),_:1}),a[1]||(a[1]=t("span",null,"ÈáçÊñ∞ÂºÄÂßã",-1))]),_:1}),g(i(Y),{type:"danger",size:"large",onClick:X},{default:C(()=>[g(c,null,{default:C(()=>[g(i(ge))]),_:1}),a[2]||(a[2]=t("span",null,"ÈÄÄÂá∫Ê∏∏Êàè",-1))]),_:1})])])])):$("",!0),g(i(ye),{type:m.value,count:D.value,trigger:k.value,position:T.value},null,8,["type","count","trigger","position"])])}}}),nt=V(et,[["__scopeId","data-v-4e21a239"]]);export{nt as default};
