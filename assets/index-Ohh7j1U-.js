import{d as V,r as u,p as O,q as W,v as ee,x as te,c as h,o as p,y as Z,n as se,j as $,a as t,z as le,t as x,F as ae,g as oe,_ as X,A as ne,u as ie,h as re,b as g,f as r,w as C,T as ue,e as J,B as ce,C as ve,D as de,G as me,H as fe,I as ge}from"./index-CEpvSAdR.js";import{G as U}from"./GameButton-BmPXT0Nb.js";import{H as T,s as w}from"./touch-handler-DtA4rPka.js";import{S as pe}from"./ParticleEffect.vue_vue_type_style_index_0_scoped_db33c9d5_lang-BsWPHX7z.js";import{P as ye}from"./ParticleEffect--kxI27hB.js";const he={key:0,class:"active-indicator"},we={class:"plane-body"},_e={class:"plane-cockpit"},be={class:"answer-text"},xe={key:1,class:"explosion"},ke={key:2,class:"wrong-indicator"},Se=V({__name:"EnemyPlane",props:{id:{},value:{},isCorrect:{type:Boolean,default:!1},position:{default:()=>({x:0,y:0})},color:{default:"blue"},isHit:{type:Boolean,default:!1},isDestroyed:{type:Boolean,default:!1},isActive:{type:Boolean,default:!1},movePattern:{default:"horizontal"},moveSpeed:{default:2},moveRange:{default:150},isMoving:{type:Boolean,default:!0},isClickDisabled:{type:Boolean,default:!1},isWrongAnswer:{type:Boolean,default:!1}},emits:["click"],setup(m,{emit:B}){const e=m,P=B,o=u(0),l=u(0),c=u(0),n=u(0),f=u(1),D=u(0),k=u(null),G=u(!1),S=u({}),R=u(null),A=u(null),Y=O(()=>[`plane-${e.color}`,{"plane-hit":e.isHit},{"plane-destroyed":e.isDestroyed},{"plane-active":e.isActive}]),M=O(()=>{const v=e.isActive?1.15:1,s=R.value!==null?R.value:o.value,_=A.value!==null?A.value:l.value,H={left:`calc(50% + ${s}px)`,top:`calc(50% + ${_}px)`,transform:`translate(-50%, -50%) scale(${v})`,transition:e.isHit||e.isDestroyed?"none":"all 0.05s linear"};return e.color&&e.color.startsWith("#")&&(H["--plane-color"]=e.color),H}),Q=()=>{e.isDestroyed||e.isHit||e.isClickDisabled||(T.light(),P("click",e.id))},N=v=>{if(e.isDestroyed||e.isHit||e.isClickDisabled)return;const s=v.touches[0],_=v.currentTarget.getBoundingClientRect(),H=s.clientX-_.left,d=s.clientY-_.top;S.value={left:`${H}px`,top:`${d}px`},G.value=!0,setTimeout(()=>{G.value=!1},600)},F=()=>{switch(E(),c.value=o.value,n.value=l.value,e.movePattern){case"horizontal":o.value=c.value,l.value=n.value,f.value=1;break;case"vertical":o.value=c.value,l.value=n.value,f.value=1;break;case"circular":D.value=0,o.value=c.value+e.moveRange*.6,l.value=n.value;break;case"zigzag":o.value=c.value,l.value=n.value,f.value=1;break;default:o.value=c.value,l.value=n.value}k.value=window.setInterval(()=>{if(!e.isDestroyed&&!e.isHit)switch(e.movePattern){case"horizontal":z();break;case"vertical":I();break;case"circular":j();break;case"zigzag":q();break;default:z()}},33)},z=()=>{o.value+=e.moveSpeed*f.value;const v=c.value-e.moveRange,s=c.value+e.moveRange;o.value<=v?(o.value=v,f.value=1):o.value>=s&&(o.value=s,f.value=-1);const _=Math.sin(Date.now()/800)*2;l.value=n.value+_},I=()=>{l.value+=e.moveSpeed*f.value;const v=n.value-e.moveRange,s=n.value+e.moveRange;l.value<=v?(l.value=v,f.value=1):l.value>=s&&(l.value=s,f.value=-1);const _=Math.sin(Date.now()/800)*2;o.value=c.value+_},j=()=>{D.value+=.02*e.moveSpeed;const v=e.moveRange*.5,s=e.moveRange*.3;o.value=c.value+Math.cos(D.value)*v,l.value=n.value+Math.sin(D.value)*s},q=()=>{o.value+=e.moveSpeed*f.value,o.value<=c.value-e.moveRange?(o.value=c.value-e.moveRange,f.value=1,l.value=l.value>n.value?n.value-e.moveRange*.2:n.value+e.moveRange*.2):o.value>=c.value+e.moveRange&&(o.value=c.value+e.moveRange,f.value=-1,l.value=l.value>n.value?n.value-e.moveRange*.3:n.value+e.moveRange*.3)},E=()=>{k.value&&(clearInterval(k.value),k.value=null)};return W(()=>e.isMoving,v=>{v?F():E()}),W(()=>e.isHit,v=>{v&&(E(),R.value=o.value,A.value=l.value)}),W(()=>e.isDestroyed,v=>{v&&E()}),ee(()=>{o.value=e.position.x||0,l.value=e.position.y||0,R.value=null,A.value=null,e.isMoving&&!e.isDestroyed&&F()}),te(()=>{E()}),(v,s)=>(p(),h("div",{class:se(["enemy-plane",Y.value]),style:Z(M.value),onClick:Q,onTouchstart:N},[m.isActive?(p(),h("div",he,[...s[0]||(s[0]=[le('<div class="active-ring active-ring-outer" data-v-0a8e9991></div><div class="active-ring active-ring-inner" data-v-0a8e9991></div><div class="active-crosshair" data-v-0a8e9991><div class="crosshair-line crosshair-h" data-v-0a8e9991></div><div class="crosshair-line crosshair-v" data-v-0a8e9991></div></div><div class="target-corners" data-v-0a8e9991><div class="corner corner-tl" data-v-0a8e9991></div><div class="corner corner-tr" data-v-0a8e9991></div><div class="corner corner-bl" data-v-0a8e9991></div><div class="corner corner-br" data-v-0a8e9991></div></div>',4)])])):$("",!0),s[10]||(s[10]=t("div",{class:"engine-flame"},[t("div",{class:"flame flame-1"}),t("div",{class:"flame flame-2"}),t("div",{class:"flame flame-3"})],-1)),t("div",we,[s[3]||(s[3]=t("div",{class:"plane-wing plane-wing-top"},null,-1)),s[4]||(s[4]=t("div",{class:"plane-wing plane-wing-bottom"},null,-1)),t("div",_e,[s[1]||(s[1]=t("div",{class:"cockpit-glass"},null,-1)),t("span",be,x(m.value),1),s[2]||(s[2]=t("div",{class:"cockpit-detail"},null,-1))]),s[5]||(s[5]=t("div",{class:"plane-tail"},[t("div",{class:"tail-fin"})],-1))]),m.isDestroyed?(p(),h("div",xe,[s[6]||(s[6]=t("div",{class:"explosion-core"},null,-1)),(p(),h(ae,null,oe(12,_=>t("div",{key:_,class:"explosion-particle"})),64)),s[7]||(s[7]=t("div",{class:"explosion-ring"},null,-1)),s[8]||(s[8]=t("div",{class:"explosion-flash"},null,-1))])):$("",!0),e.isWrongAnswer?(p(),h("div",ke,[...s[9]||(s[9]=[t("div",{class:"wrong-icon"},[t("span",{class:"wrong-text"},"‚úó")],-1),t("div",{class:"wrong-wave"},null,-1)])])):$("",!0),G.value?(p(),h("div",{key:3,class:"touch-ripple",style:Z(S.value)},null,4)):$("",!0)],38))}}),Ce=X(Se,[["__scopeId","data-v-0a8e9991"]]),$e={class:"question-display"},Be={class:"question-container"},De={class:"question-text"},Re={class:"progress-info"},Ae={class:"progress-text"},Ee=V({__name:"QuestionDisplay",props:{questionText:{default:""},currentIndex:{default:0},totalQuestions:{default:10}},setup(m){return(B,e)=>(p(),h("div",$e,[t("div",Be,[t("span",De,x(m.questionText),1)]),t("div",Re,[t("span",Ae,"Á¨¨ "+x(m.currentIndex+1)+" / "+x(m.totalQuestions)+" È¢ò",1)])]))}}),Te=X(Ee,[["__scopeId","data-v-76168665"]]),Ge={class:"game-stats"},Me={class:"stats-row"},ze={class:"stat-item stat-score"},Ie={class:"stat-value"},He={key:0,class:"stat-item stat-combo"},qe={class:"stat-value combo-value"},Le={class:"stat-item stat-correct"},Pe={class:"stat-value"},Qe={class:"stat-item stat-wrong"},Fe={class:"stat-value"},We={key:1,class:"stat-item stat-timer"},Oe=V({__name:"GameStats",props:{score:{default:0},combo:{default:0},correctCount:{default:0},wrongCount:{default:0},timeLeft:{default:0},showTimer:{type:Boolean,default:!1}},setup(m){return(B,e)=>(p(),h("div",Ge,[t("div",Me,[t("div",ze,[e[0]||(e[0]=t("span",{class:"stat-icon"},"‚≠ê",-1)),t("span",Ie,x(m.score),1)]),m.combo>1?(p(),h("div",He,[e[1]||(e[1]=t("span",{class:"stat-label"},"ËøûÂáª",-1)),t("span",qe,x(m.combo)+"x",1)])):$("",!0),t("div",Le,[e[2]||(e[2]=t("span",{class:"stat-icon"},"‚úì",-1)),t("span",Pe,x(m.correctCount),1)]),t("div",Qe,[e[3]||(e[3]=t("span",{class:"stat-icon"},"‚úó",-1)),t("span",Fe,x(m.wrongCount),1)]),m.showTimer?(p(),h("div",We,[e[4]||(e[4]=t("span",{class:"stat-icon"},"‚è±",-1)),t("span",{class:se(["stat-value",{"timer-warning":m.timeLeft<=3}])},x(m.timeLeft)+"s",3)])):$("",!0)])]))}}),Ve=X(Oe,[["__scopeId","data-v-95531e82"]]),K="/x-game/assets/bgm_battle-DrTQayCI.mp3",Xe={class:"number-battle-container"},Ye={key:0,class:"game-screen"},Ne={class:"game-area"},je={key:0,class:"error-message"},Ue={class:"game-controls"},Ze={key:1,class:"pause-screen"},Je={class:"pause-content"},Ke={class:"pause-buttons"},et=V({__name:"index",setup(m){const B=re(),e=ne(),P=ie(),o=u([]),l=u(""),c=u(10),n=u(null),f=u("explosion"),D=u(12),k=u(0),G=u({x:50,y:50}),S=u(!1),R=u(!1),A=u(""),Y=O(()=>e.gameState.currentQuestion),M=O(()=>e.currentBattleQuestion),Q=()=>{if(!M.value)return;const d=[M.value.correctAnswer,...M.value.wrongAnswers],a=N(d);o.value=ce.createEnemies(a,M.value.correctAnswer)},N=d=>{const a=[...d];for(let i=a.length-1;i>0;i--){const b=Math.floor(Math.random()*(i+1));[a[i],a[b]]=[a[b],a[i]]}return a},F=d=>{if(S.value)return;const a=o.value.find(i=>i.id===d);!a||a.isHit||a.isDestroyed||(l.value=d,a.isHit=!0,o.value.forEach(i=>{i.isHit=!0}),a.isCorrect?(S.value=!0,w.play("correct"),T.success(),f.value="success",D.value=16,k.value++,setTimeout(()=>{a.isDestroyed=!0,w.play("explosion"),o.value.forEach(i=>{i.id!==a.id&&!i.isDestroyed&&(i.isDestroyed=!0)}),e.handleCorrectAnswer(),e.gameState.progress.combo>1&&(w.play("combo"),f.value="combo",k.value++),setTimeout(()=>{S.value=!1,z()},800)},300)):(S.value=!0,w.play("wrong"),T.error(),a.isWrongAnswer=!0,f.value="error",D.value=1,k.value++,G.value={x:a.position.x,y:a.position.y},A.value="‚ùå Á≠îÈîô‰∫ÜÔºÅüò¢",R.value=!0,e.handleWrongAnswer(a.value),setTimeout(()=>{R.value=!1,S.value=!1,a.isHit=!1,a.isWrongAnswer=!1,l.value="",z()},2e3)))},z=()=>{e.gameState.progress.currentIndex>=e.gameState.config.totalQuestions-1?H():(e.updateCurrentQuestion(),Q(),l.value="",e.gameState.config.difficulty==="hard"&&j())},I=()=>{e.gameState.config.difficulty==="hard"&&(c.value=10,n.value=window.setInterval(()=>{c.value--,c.value<=3&&c.value>0&&w.play("countdown"),c.value<=0&&(e.handleWrongAnswer(0),z())},1e3))},j=()=>{n.value&&clearInterval(n.value),I()},q=()=>{n.value&&(clearInterval(n.value),n.value=null)},E=()=>{w.play("select"),T.light(),e.pauseGame(),q()},v=()=>{w.play("select"),T.light(),e.resumeGame(),e.gameState.config.difficulty==="hard"&&I()},s=()=>{w.play("select"),T.light(),e.resetGame(),B.push("/number-battle/settings")},_=()=>{w.play("select"),T.light(),e.endGame(),B.push("/")},H=()=>{q(),w.play("gameOver");const d=e.endGame();P.updateLearningProgress({totalGames:1,totalCorrect:d.correctCount,totalWrong:d.wrongCount,totalTime:d.totalTime,bestScore:d.score}),P.checkAchievements(),B.push("/result")};return W(()=>e.gameState.status,d=>{d==="playing"&&e.gameState.config.difficulty==="hard"&&I()}),ee(()=>{if(e.gameState.status!=="playing"){B.push("/number-battle/settings");return}const d=()=>{const b=document.documentElement,L=b.requestFullscreen||b.webkitRequestFullscreen||b.mozRequestFullScreen||b.msRequestFullscreen;L&&L.call(b).catch(y=>{console.warn("ÂÖ®Â±èËØ∑Ê±ÇÂ§±Ë¥•:",y)})},a=()=>{d(),document.removeEventListener("click",a),document.removeEventListener("touchstart",a)};document.addEventListener("click",a,{once:!0}),document.addEventListener("touchstart",a,{once:!0}),d(),Q(),e.gameState.config.difficulty==="hard"&&I();const i=()=>{w.playBGM(K),document.removeEventListener("click",i),document.removeEventListener("touchstart",i)};document.addEventListener("click",i,{once:!0}),document.addEventListener("touchstart",i,{once:!0}),w.playBGM(K)}),te(()=>{q(),w.stopBGM()}),(d,a)=>{var L;const i=J("el-icon"),b=J("el-button");return p(),h("div",Xe,[g(r(pe)),r(e).gameState.status==="playing"?(p(),h("div",Ye,[g(r(Ve),{score:r(e).gameState.progress.score,combo:r(e).gameState.progress.combo,"correct-count":r(e).gameState.progress.correctCount,"wrong-count":r(e).gameState.progress.wrongCount,"time-left":c.value,"show-timer":r(e).gameState.config.difficulty==="hard"},null,8,["score","combo","correct-count","wrong-count","time-left","show-timer"]),g(r(Te),{"question-text":((L=Y.value)==null?void 0:L.text)||"","current-index":r(e).gameState.progress.currentIndex,"total-questions":r(e).gameState.config.totalQuestions},null,8,["question-text","current-index","total-questions"]),t("div",Ne,[(p(!0),h(ae,null,oe(o.value,y=>(p(),ve(r(Ce),{key:y.id,id:y.id,value:y.value,"is-correct":y.isCorrect,position:y.position,color:y.color,"is-hit":y.isHit,"is-destroyed":y.isDestroyed,"is-active":l.value===y.id,"move-pattern":y.movePattern,"move-speed":y.moveSpeed,"move-range":y.moveRange,"is-moving":r(e).gameState.config.enemyMoving,"is-click-disabled":S.value,"is-wrong-answer":y.isWrongAnswer,onClick:F},null,8,["id","value","is-correct","position","color","is-hit","is-destroyed","is-active","move-pattern","move-speed","move-range","is-moving","is-click-disabled","is-wrong-answer"]))),128)),g(ue,{name:"error-message"},{default:C(()=>[R.value?(p(),h("div",je,x(A.value),1)):$("",!0)]),_:1})]),t("div",Ue,[g(b,{circle:"",size:"large",onClick:E},{default:C(()=>[g(i,null,{default:C(()=>[g(r(de))]),_:1})]),_:1})])])):$("",!0),r(e).gameState.status==="paused"?(p(),h("div",Ze,[t("div",Je,[a[3]||(a[3]=t("h2",{class:"pause-title"},"Ê∏∏ÊàèÊöÇÂÅú",-1)),t("div",Ke,[g(r(U),{type:"success",size:"large",onClick:v},{default:C(()=>[g(i,null,{default:C(()=>[g(r(me))]),_:1}),a[0]||(a[0]=t("span",null,"ÁªßÁª≠Ê∏∏Êàè",-1))]),_:1}),g(r(U),{type:"warning",size:"large",onClick:s},{default:C(()=>[g(i,null,{default:C(()=>[g(r(fe))]),_:1}),a[1]||(a[1]=t("span",null,"ÈáçÊñ∞ÂºÄÂßã",-1))]),_:1}),g(r(U),{type:"danger",size:"large",onClick:_},{default:C(()=>[g(i,null,{default:C(()=>[g(r(ge))]),_:1}),a[2]||(a[2]=t("span",null,"ÈÄÄÂá∫Ê∏∏Êàè",-1))]),_:1})])])])):$("",!0),g(r(ye),{type:f.value,count:D.value,trigger:k.value,position:G.value},null,8,["type","count","trigger","position"])])}}}),nt=X(et,[["__scopeId","data-v-3e5990ff"]]);export{nt as default};
